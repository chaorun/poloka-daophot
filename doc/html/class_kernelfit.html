<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KernelFit class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.6 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; <a class="qindexRef" doxygen="_cgi:http://ici.la.bas/toto/tata/search.cgi" href="http://ici.la.bas/toto/tata/search.cgi">Search</a> &nbsp; </center>
<hr><h1>KernelFit  Class Reference</h1><a class="el" href="class_kernel.html">Kernel</a> fitting by least squares. 
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="kernelfit_h-source.html">kernelfit.h</a>&gt;</code>
<p>
<a href="class_kernelfit-members.html">List of all members.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Public Methods</h2></td></tr>
<tr><td nowrap align=right valign=top><a name="a0" doxytag="KernelFit::HKernelSizeX"></a>
int&nbsp;</td><td valign=bottom><b>HKernelSizeX</b> ()</td></tr>
<tr><td nowrap align=right valign=top><a name="a1" doxytag="KernelFit::HKernelSizeY"></a>
int&nbsp;</td><td valign=bottom><b>HKernelSizeY</b> ()</td></tr>
<tr><td nowrap align=right valign=top><a name="a2" doxytag="KernelFit::KernIndex"></a>
int&nbsp;</td><td valign=bottom><b>KernIndex</b> (int iKernel, int iSpatial) const</td></tr>
<tr><td nowrap align=right valign=top><a name="a3" doxytag="KernelFit::BackIndex"></a>
int&nbsp;</td><td valign=bottom><b>BackIndex</b> (int ib) const</td></tr>
<tr><td nowrap align=right valign=top><a name="a4" doxytag="KernelFit::BackValue"></a>
double&nbsp;</td><td valign=bottom><b>BackValue</b> (const double &amp;x, const double &amp;y) const</td></tr>
<tr><td nowrap align=right valign=top><a name="a5" doxytag="KernelFit::DeleteConvolvedBest"></a>
void&nbsp;</td><td valign=bottom><b>DeleteConvolvedBest</b> ()</td></tr>
<tr><td nowrap align=right valign=top><a name="a6" doxytag="KernelFit::KernelFit"></a>
&nbsp;</td><td valign=bottom><b>KernelFit</b> ()</td></tr>
<tr><td nowrap align=right valign=top><a name="a7" doxytag="KernelFit::~KernelFit"></a>
&nbsp;</td><td valign=bottom><b>~KernelFit</b> ()</td></tr>
<tr><td nowrap align=right valign=top><a name="a8" doxytag="KernelFit::KernelsFill"></a>
void&nbsp;</td><td valign=bottom><b>KernelsFill</b> ()</td></tr>
<tr><td nowrap align=right valign=top><a name="a9" doxytag="KernelFit::AllocateConvolvedStamps"></a>
void&nbsp;</td><td valign=bottom><b>AllocateConvolvedStamps</b> ()</td></tr>
<tr><td nowrap align=right valign=top><a name="a10" doxytag="KernelFit::DeallocateConvolvedStamps"></a>
void&nbsp;</td><td valign=bottom><b>DeallocateConvolvedStamps</b> ()</td></tr>
<tr><td nowrap align=right valign=top><a name="a11" doxytag="KernelFit::ComputeMAndB"></a>
void&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#a11">ComputeMAndB</a> ()</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>sums least square matrix and vector for all stamps.</em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="a12" doxytag="KernelFit::OneStampMAndB"></a>
void&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#a12">OneStampMAndB</a> (const <a class="el" href="class_stamp.html">Stamp</a> &amp;Astamp, double *StampM, double *StampB)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>computes least square matrix and vector for one stamp.</em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="a13" doxytag="KernelFit::SubtractStampFromMAndB"></a>
void&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#a13">SubtractStampFromMAndB</a> (<a class="el" href="class_stamp.html">Stamp</a> &amp;AStamp)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>subtract a stamp of the least square matrix and vector.</em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="a14" doxytag="KernelFit::Solve"></a>
int&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#a14">Solve</a> ()</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>actually solves the system by calling linear algebra efficient routines.</em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="a15" doxytag="KernelFit::StampChi2"></a>
double&nbsp;</td><td valign=bottom><b>StampChi2</b> (<a class="el" href="class_stamp.html">Stamp</a> &amp;stamp, double VSky, double InvGain)</td></tr>
<tr><td nowrap align=right valign=top><a name="a16" doxytag="KernelFit::NStampsUsed"></a>
int&nbsp;</td><td valign=bottom><b>NStampsUsed</b> () const</td></tr>
<tr><td nowrap align=right valign=top><a name="a17" doxytag="KernelFit::FilterStamps"></a>
void&nbsp;</td><td valign=bottom><b>FilterStamps</b> ()</td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#a18">DoTheFit</a> (const BaseStarList &amp;List, double &amp;BestSeeing, double &amp;WorstSeeing)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>final wrapper that calls various routines to fill matrix and vector, and then solve.</em> <a href="#a18">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="a19" doxytag="KernelFit::DoIt"></a>
int&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#a19">DoIt</a> (const BaseStarList &amp;List, double &amp;BestSeeing, double &amp;WorstSeeing)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>does the kernel fit (DoTheFit) and the convolution (BestImageConvolve).</em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="a20" doxytag="KernelFit::KernCompute"></a>
void&nbsp;</td><td valign=bottom><b>KernCompute</b> (<a class="el" href="class_kernel.html">Kernel</a> &amp;Result, const double X, const double Y) const</td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#a21">BestImageConvolve</a> (int UpdateKernStep=100)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>convolves the best image with the current kernel (Usually set by DoTheFit).</em> <a href="#a21">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="a22" doxytag="KernelFit::VarianceConvolve"></a>
<a class="el" href="class_image.html">Image</a>*&nbsp;</td><td valign=bottom><b>VarianceConvolve</b> (const <a class="el" href="class_image.html">Image</a> &amp;Source, int UpdateKern=100)</td></tr>
<tr><td colspan=2><br><h2>Public Attributes</h2></td></tr>
<tr><td nowrap align=right valign=top><a name="m0" doxytag="KernelFit::BestImage"></a>
const <a class="el" href="class_image.html">Image</a>*&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#m0">BestImage</a></td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>pointer to 'best' image (smaller seeing).</em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="m1" doxytag="KernelFit::WorstImage"></a>
const <a class="el" href="class_image.html">Image</a>*&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#m1">WorstImage</a></td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>pointer to 'worst' image (larger seeing).</em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="m2" doxytag="KernelFit::BestImageBack"></a>
double&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#m2">BestImageBack</a></td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>the value of the sky of the best image.</em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="m3" doxytag="KernelFit::WorstImageBack"></a>
double&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#m3">WorstImageBack</a></td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>the value of the sky of the worst image.</em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="m4" doxytag="KernelFit::SkyVarianceWorstImage"></a>
double&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#m4">SkyVarianceWorstImage</a></td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>the value of the sky variance of WorstImage.</em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="m5" doxytag="KernelFit::WorstImageGain"></a>
double&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#m5">WorstImageGain</a></td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>the gain of WorstImage.</em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="m6" doxytag="KernelFit::KernAtCenterSum"></a>
double&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#m6">KernAtCenterSum</a></td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>the kernel integral at the image center (photometric ratio).</em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="m7" doxytag="KernelFit::Kernels"></a>
vector&lt;<a class="el" href="class_kernel.html">Kernel</a>&gt;&nbsp;</td><td valign=bottom><b>Kernels</b></td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="class_stamplist.html">StampList</a>*&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#m8">BestImageStamps</a></td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>the base used to build the 'best' kernel */ the list of stamps in the 'best' image.</em> <a href="#m8">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="m9" doxytag="KernelFit::ConvolvedBest"></a>
<a class="el" href="class_image.html">Image</a>*&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#m9">ConvolvedBest</a></td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>a pointer to the 'best' image convolved with the solution.</em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="m10" doxytag="KernelFit::convolutions"></a>
<a class="el" href="class_dimage.html">DImage</a>*&nbsp;</td><td valign=bottom><b>convolutions</b></td></tr>
<tr><td nowrap align=right valign=top><a name="m11" doxytag="KernelFit::backStamps"></a>
<a class="el" href="class_dimage.html">DImage</a>*&nbsp;</td><td valign=bottom><b>backStamps</b></td></tr>
<tr><td nowrap align=right valign=top><a name="m12" doxytag="KernelFit::optParams"></a>
OptParams&nbsp;</td><td valign=bottom><b>optParams</b></td></tr>
<tr><td nowrap align=right valign=top><a name="m13" doxytag="KernelFit::mSize"></a>
int&nbsp;</td><td valign=bottom><b>mSize</b></td></tr>
<tr><td nowrap align=right valign=top><a name="m14" doxytag="KernelFit::backStart"></a>
int&nbsp;</td><td valign=bottom><b>backStart</b></td></tr>
<tr><td nowrap align=right valign=top><a name="m15" doxytag="KernelFit::m"></a>
double*&nbsp;</td><td valign=bottom><b>m</b></td></tr>
<tr><td nowrap align=right valign=top>double*&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#m16">b</a></td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>the least-squares matrix (the second derivative of chi2 w.r.t fitted parameters */;.</em> <a href="#m16">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>double*&nbsp;</td><td valign=bottom><a class="el" href="class_kernelfit.html#m17">solution</a></td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>the normal equations (i.e. grad(chi2) = 0) right hand side */.</em> <a href="#m17">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a name="m18" doxytag="KernelFit::chi2"></a>
double&nbsp;</td><td valign=bottom><b>chi2</b></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
<a class="el" href="class_kernel.html">Kernel</a> fitting by least squares.
<p>
Implementation of Ch. Alard's method for fitting (slowly variable)  convolution kernels. see astro-ph 9903111 &amp; astro-ph 9712287  (where most of the equations of page 2 are wrong). Main differences with the "isis" code provided by Alard himself: <ul>
<li> if the integral of the kernel is requested to be constant over the image, we use Lagrange multipliers instead of something I could not understand. (paper from 97 page 3 first column). <li> for the detection of outliers, we compute the chi2 of all stamps,  apply median filtering, refit, and iterate until stabilization of the number of stamps. This is in fact fairly fast because we have routines to  add or remove one stamp from the fit. </ul>

<p>
<hr><h2>Member Function Documentation</h2>
<a name="a21" doxytag="KernelFit::BestImageConvolve"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
void KernelFit::BestImageConvolve (
          </b></td>
          <td valign="bottom"><b>
int <em>UpdateKern</em> = 100&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
convolves the best image with the current kernel (Usually set by DoTheFit).
<p>
The UpdateKern parameter is the pixel range over which the kernel will not be updated. The concolved image is to be found in ConvolvedBest.     </td>
  </tr>
</table>
<a name="a18" doxytag="KernelFit::DoTheFit"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
int KernelFit::DoTheFit (
          </b></td>
          <td valign="bottom"><b>
const BaseStarList &amp; <em>List</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
double &amp; <em>BestSeeing</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
double &amp; <em>WorstSeeing</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
final wrapper that calls various routines to fill matrix and vector, and then solve.
<p>
Before entering here, 'this' should have the BestImage and WorstImage fields assigned. The various sizes of the stamps involved in kernel fit are computed by OptParams::OptimizeSizes(). There is no way yet to by-pass it and setup the fit conditions by yourself (it would be simple to implement). The returned value is 0 if the kernel fit failed (and hence 'this' contains no viable kernel). <dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>List</em>
&nbsp;</td><td>
contains the stars elligible to fit the kernel. </td></tr>
</table>
</dl>    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a name="m8" doxytag="KernelFit::BestImageStamps"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
<a class="el" href="class_stamplist.html">StampList</a> * KernelFit::BestImageStamps
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
the base used to build the 'best' kernel */ the list of stamps in the 'best' image.
<p>
/*     </td>
  </tr>
</table>
<a name="m16" doxytag="KernelFit::b"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
double * KernelFit::b
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
the least-squares matrix (the second derivative of chi2 w.r.t fitted parameters */;.
<p>
/*     </td>
  </tr>
</table>
<a name="m17" doxytag="KernelFit::solution"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
double * KernelFit::solution
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
the normal equations (i.e. grad(chi2) = 0) right hand side */.
<p>
/*     </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="kernelfit_h-source.html">kernelfit.h</a><li>kernelfit.cc</ul>
<hr><address><small>Generated at Sun Feb 8 18:22:50 2004 for toads by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.6 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
