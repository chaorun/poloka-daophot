<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>detection.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.6 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; <a class="qindexRef" doxygen="_cgi:http://ici.la.bas/toto/tata/search.cgi" href="http://ici.la.bas/toto/tata/search.cgi">Search</a> &nbsp; </center>
<hr><h1>detection.h</h1><div class="fragment"><pre>00001 <font class="preprocessor">#ifndef DETECTION__H</font>
00002 <font class="preprocessor"></font><font class="preprocessor">#define DETECTION__H</font>
00003 <font class="preprocessor"></font>
00004 <font class="preprocessor">#include &lt;string&gt;</font>
00005 <font class="preprocessor">#include "<a class="code" href="basestar_h.html">basestar.h</a>"</font>
00006 
00007 <font class="keyword">class </font>Detection : <font class="keyword">public</font> <a class="code" href="class_basestar.html">BaseStar</a>
00008 {
00009   <font class="keyword">private</font>:
00010   <font class="keywordtype">double</font> eFlux;
00011   <font class="keywordtype">double</font> sig2Noise;
00012   <font class="keywordtype">double</font> aperFlux;
00013   <font class="keywordtype">double</font> sig2NoiseCv;
00014   <font class="keywordtype">double</font> xs; <font class="comment">// start position</font>
00015   <font class="keywordtype">double</font> ys; <font class="comment">// start position</font>
00016   <font class="keywordtype">double</font> varXX; <font class="comment">// pos error. ordering xx,yy,xy relevant...</font>
00017   <font class="keywordtype">double</font> varYY; <font class="comment">// pos error</font>
00018   <font class="keywordtype">double</font> varXY; <font class="comment">// pos error</font>
00019   <font class="keywordtype">int</font> area; <font class="comment">// number of pixels  used in aperflux</font>
00020   <font class="keywordtype">int</font> nBad; <font class="comment">// number of bad pixels (i.e. w=0)</font>
00021   <font class="keywordtype">double</font> distBad; <font class="comment">// distance to nearest bad pixel</font>
00022   <font class="keywordtype">double</font> mxx; <font class="comment">// shape param</font>
00023   <font class="keywordtype">double</font> myy;<font class="comment">// shape param</font>
00024   <font class="keywordtype">double</font> mxy;<font class="comment">// shape param</font>
00025   <font class="comment">// Reference related scores</font>
00026   <font class="keywordtype">double</font> ra;
00027   <font class="keywordtype">double</font> dec;
00028   <font class="keywordtype">double</font> vRaRa, vDecDec , vRaDec; <font class="comment">// ordering important.</font>
00029   <font class="keywordtype">double</font> fluxRef; <font class="comment">// flux under the SN</font>
00030   <font class="keywordtype">double</font> prctInc; <font class="comment">// flux/fluxref if fluxref&gt;0 100. if not</font>
00031   <font class="keywordtype">double</font> xObj, yObj; <font class="comment">// coordinates of object on ref</font>
00032   <font class="keywordtype">double</font> fluxObjRef; <font class="comment">// flux of nearest object</font>
00033   <font class="keywordtype">double</font> distObjRef; <font class="comment">// distance to the latter  </font>
00034 
00035   <font class="keywordtype">double</font> localback ; <font class="comment">// local background as computed by detector</font>
00036  
00038   <font class="keywordtype">void</font> read_it(istream&amp; r, <font class="keyword">const</font> <font class="keywordtype">char</font>* Format);
00039 
00040 
00041   <font class="keyword">public</font>:
00042   Detection(<font class="keyword">const</font> <font class="keywordtype">double</font> X=0, <font class="keyword">const</font> <font class="keywordtype">double</font> Y=0, <font class="keyword">const</font> <font class="keywordtype">double</font> Flux=0);
00043 
00044   <font class="keywordtype">double</font> LocalBack()<font class="keyword"> const </font>{<font class="keywordflow">return</font> localback;}
00045   <font class="keywordtype">double</font> &amp;LocalBack()<font class="keyword"> </font>{ <font class="keywordflow">return</font> localback;}
00046 
00047 
00048   <font class="keywordtype">double</font> EFlux()<font class="keyword"> const </font>{<font class="keywordflow">return</font> eFlux;}
00049   <font class="keywordtype">double</font> &amp;EFlux()<font class="keyword"> </font>{ <font class="keywordflow">return</font> eFlux;}
00050 
00051   <font class="keywordtype">double</font> AperFlux()<font class="keyword"> const </font>{<font class="keywordflow">return</font> aperFlux;}
00052   <font class="keywordtype">double</font> &amp;AperFlux()<font class="keyword"> </font>{<font class="keywordflow">return</font> aperFlux;}
00053 
00054   <font class="keywordtype">double</font> Mxx()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> mxx;}
00055   <font class="keywordtype">double</font> &amp;Mxx()<font class="keyword"> </font>{ <font class="keywordflow">return</font> mxx;}
00056 
00057   <font class="keywordtype">double</font> Mxy()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> mxy;}
00058   <font class="keywordtype">double</font> &amp;Mxy()<font class="keyword"> </font>{ <font class="keywordflow">return</font> mxy;}
00059   
00060   <font class="keywordtype">double</font> Myy()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> myy;}
00061   <font class="keywordtype">double</font> &amp;Myy()<font class="keyword"> </font>{ <font class="keywordflow">return</font> myy;}
00062 
00063   <font class="keywordtype">double</font> VarXX()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> varXX;}
00064   <font class="keywordtype">double</font> &amp;VarXX()<font class="keyword"> </font>{ <font class="keywordflow">return</font> varXX;}
00065 
00066   <font class="keywordtype">double</font> VarXY()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> varXY;}
00067   <font class="keywordtype">double</font> &amp;VarXY()<font class="keyword"> </font>{ <font class="keywordflow">return</font> varXY;}
00068   
00069   <font class="keywordtype">double</font> VarYY()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> varYY;}
00070   <font class="keywordtype">double</font> &amp;VarYY()<font class="keyword"> </font>{ <font class="keywordflow">return</font> varYY;}
00071 
00072   <font class="keywordtype">double</font> VarRaRa()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> vRaRa;}
00073   <font class="keywordtype">double</font> &amp;VarRaRa()<font class="keyword"> </font>{ <font class="keywordflow">return</font> vRaRa;}
00074 
00075   <font class="keywordtype">double</font> VarRaDec()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> vRaDec;}
00076   <font class="keywordtype">double</font> &amp;VarRaDec()<font class="keyword"> </font>{ <font class="keywordflow">return</font> vRaDec;}
00077   
00078   <font class="keywordtype">double</font> VarDecDec()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> vDecDec;}
00079   <font class="keywordtype">double</font> &amp;VarDecDec()<font class="keyword"> </font>{ <font class="keywordflow">return</font> vDecDec;}
00080 
00081   <font class="keywordtype">int</font> Area()<font class="keyword"> const </font>{<font class="keywordflow">return</font> area;}
00082   <font class="keywordtype">int</font>&amp; Area()<font class="keyword"> </font>{ <font class="keywordflow">return</font> area;}
00083 
00084   <font class="keywordtype">int</font> NBad()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> nBad;}
00085   <font class="keywordtype">int</font> &amp;NBad()<font class="keyword"> </font>{ <font class="keywordflow">return</font> nBad;}
00086 
00087   <font class="keywordtype">double</font> Sig2Noise()<font class="keyword"> const </font>{ <font class="keywordflow">return</font> sig2Noise;}
00088 
00089   <font class="keywordtype">double</font> Ra()<font class="keyword"> const </font>{<font class="keywordflow">return</font> ra;}
00090   <font class="keywordtype">double</font> &amp;Ra()<font class="keyword"> </font>{ <font class="keywordflow">return</font> ra;}
00091 
00092   <font class="keywordtype">double</font> Dec()<font class="keyword"> const </font>{<font class="keywordflow">return</font> dec;}
00093   <font class="keywordtype">double</font> &amp;Dec()<font class="keyword"> </font>{ <font class="keywordflow">return</font> dec;}
00094 
00095   <font class="keyword">friend</font> <font class="keyword">class </font>DetectionProcess;
00096 
00097   <font class="comment">// IO's</font>
00098   std::string WriteHeader_(ostream &amp; stream, <font class="keyword">const</font> <font class="keywordtype">char</font>*i) <font class="keyword">const</font>;
00099   <font class="keyword">static</font> Detection* read(istream&amp; r, <font class="keyword">const</font> <font class="keywordtype">char</font>* Format);
00100   <font class="keywordtype">void</font> writen(ostream &amp;s) <font class="keyword">const</font> ;
00101 };
00102 
00103 
00104 <font class="preprocessor">#include "starlist.h"</font>
00105 
00106 
00107 <font class="keyword">typedef</font> <a class="code" href="class_starlist.html">StarList&lt;Detection&gt;</a> <a class="code" href="class_starlist.html">DetectionList</a>;
00108 <font class="keyword">typedef</font> DetectionList::iterator <a class="code" href="class_starlist.html">DetectionIterator</a>;
00109 <font class="keyword">typedef</font> DetectionList::const_iterator <a class="code" href="class_starlist.html">DetectionCIterator</a>;
00110 
00111 
00112 <font class="keyword">typedef</font> <a class="code" href="class_countedref.html">CountedRef&lt;Detection&gt;</a> <a class="code" href="class_countedref.html">DetectionRef</a>;
00113 
00114 
00115 <a class="code" href="class_starlist.html">BaseStarList</a> *Detection2Base(<a class="code" href="class_starlist.html">DetectionList</a> *D);
00116 
00117 
00118 <font class="keyword">class </font><a class="code" href="class_image.html">Image</a>;
00119 <font class="keyword">class </font><a class="code" href="class_reducedimage.html">ReducedImage</a>;
00120 
00121 <font class="keyword">class </font>DetectionProcess {
00122   <font class="keyword">private</font> :
00123     <font class="keywordtype">double</font> seeing; <font class="comment">// actual image seeing</font>
00124   <font class="keywordtype">double</font> sigFilter; <font class="comment">// sigma of gaussian filetr used for convolution.</font>
00125     <font class="keywordtype">double</font> cvImageNormalizedSig; <font class="comment">// sigma of convolver image normalized to convolved variance. should be 1 in the absence of pixel correlations.</font>
00126 <font class="comment">// average of convolver image normalized to convolved variance. should be 0.</font>
00127     <font class="keywordtype">double</font> cvImageNormalizedMean; 
00128 
00129      <font class="keywordtype">double</font> radBackMin;<font class="comment">// radius of inner disk avoided in the  area used to estimate background</font>
00130     <font class="keywordtype">double</font> radBackMax;<font class="comment">// half side of square area used to estimate background</font>
00131 
00132     <a class="code" href="class_image.html">Image</a> *image; <font class="comment">// the image</font>
00133     <a class="code" href="class_image.html">Image</a> *imagecv; <font class="comment">// ... convolved with a gaussian filter</font>
00134     <a class="code" href="class_image.html">Image</a> *weight; <font class="comment">// weight image</font>
00135     string imageName;
00136     string weightName;
00137     <font class="comment">// detection  cuts : </font>
00138     <font class="keywordtype">double</font> nSigDet; <font class="comment">// cut on convolved image</font>
00139     <font class="keywordtype">double</font> nSig; <font class="comment">// final cut on flux</font>
00140     <font class="keywordtype">double</font> radAper;
00141     <font class="keywordtype">double</font> radWeight;
00142     <font class="keywordtype">double</font> radBad;
00143     <font class="keywordtype">double</font> minDistDouble;
00144     
00145 
00146  <font class="keyword">public</font>:
00148       DetectionProcess(<font class="keyword">const</font> string &amp;ImageName, 
00149                                    <font class="keyword">const</font> string &amp;WeightName, 
00150                        <font class="keyword">const</font> <font class="keywordtype">double</font> Seeing, <font class="keyword">const</font> <font class="keywordtype">double</font> SigFilter);
00151 
00153     <font class="keywordtype">void</font> DoDetection(<a class="code" href="class_starlist.html">DetectionList</a>&amp;);
00154 
00156     <font class="keywordtype">void</font> DetectionScoresFromPositions(<font class="keyword">const</font> <a class="code" href="class_starlist.html">BaseStarList</a> &amp;In, 
00157                                       <a class="code" href="class_starlist.html">DetectionList</a> &amp;Out, 
00158                                       <font class="keywordtype">bool</font> FixedPositions = <font class="keyword">false</font>);
00159 
00161 
00162     <font class="keywordtype">void</font> SetScoresFromRef(<a class="code" href="class_starlist.html">DetectionList</a> &amp;List, <font class="keyword">const</font> <a class="code" href="class_reducedimage.html">ReducedImage</a> &amp;Ref);
00163 
00164     ~DetectionProcess();
00165 
00166  <font class="keyword">private</font>:
00167 
00168     <font class="keywordtype">void</font> FluxFromPos(<font class="keyword">const</font> <a class="code" href="class_point.html">Point</a> &amp;Where, <font class="keywordtype">double</font> &amp;Flux);
00169 
00170     <font class="keywordtype">void</font> SetCuts(<font class="keyword">const</font> <font class="keywordtype">int</font> ToPrint = 0);
00171 
00172     <font class="keywordtype">void</font> ImagesConvolve();
00173 
00174     <font class="keywordtype">void</font> SaveNormalizedSig() <font class="keyword">const</font>;
00175     <font class="keywordtype">bool</font> GetNormalizedSig();
00176 
00178     <font class="keywordtype">void</font> FirstDetections(<a class="code" href="class_starlist.html">DetectionList</a> &amp;) <font class="keyword">const</font>;
00179     <font class="keywordtype">void</font> DetectionPosition(Detection &amp;Det) <font class="keyword">const</font>;
00180     <font class="keywordtype">void</font> SetDetectionScores(Detection &amp;Det) <font class="keyword">const</font>;
00181     <font class="keywordtype">void</font> RefineDetectionPosition(Detection &amp;Det) <font class="keyword">const</font>;
00182     <font class="keywordtype">double</font> LocalImageBackground(<font class="keyword">const</font> <font class="keywordtype">int</font> i, <font class="keyword">const</font> <font class="keywordtype">int</font> j) <font class="keyword">const</font>;
00183 
00184 
00185 
00186 };
00187 
00188 <font class="preprocessor">#include &lt;vector&gt;</font>
00189 
00190   
00191 <font class="keyword">class </font>MatchedDetection : <font class="keyword">public</font> Detection
00192 {
00193  <font class="keyword">private</font>:
00194   vector&lt;DetectionRef&gt; others;
00195 
00196  <font class="keyword">public</font>:
00197   MatchedDetection()<font class="keyword"> </font>{}
00198   MatchedDetection(<font class="keyword">const</font> Detection &amp;D) : Detection(D) {};
00199 
00200   <font class="keywordtype">void</font> AssociateDet(Detection *OtherDet )<font class="keyword"></font>
00201 <font class="keyword">    </font>{others.push_back(OtherDet);}
00202 
00203   <font class="keywordtype">bool</font> CompatibleSig2Noise(<font class="keyword">const</font> <font class="keywordtype">double</font> &amp;Fact) <font class="keyword">const</font>;
00204   <font class="keywordtype">bool</font> CompatiblePosition(<font class="keyword">const</font> <font class="keywordtype">double</font> &amp;DistMax) <font class="keyword">const</font>;
00205   std::string WriteHeader_(ostream &amp; stream, <font class="keyword">const</font> <font class="keywordtype">char</font>*i) <font class="keyword">const</font>;
00206   <font class="keyword">static</font> MatchedDetection* read(istream&amp; r, <font class="keyword">const</font> <font class="keywordtype">char</font>* Format);
00207   <font class="keywordtype">void</font> writen(ostream &amp;s) <font class="keyword">const</font> ;
00208 };
00209 
00210 
00211 
00212 <font class="preprocessor">#include "stringlist.h"</font>
00213 
00214 <font class="keyword">class </font>MatchedDetectionList : <font class="keyword">public</font> <a class="code" href="class_starlist.html">StarList</a>&lt;MatchedDetection&gt;
00215 {
00216  <font class="keyword">private</font>:
00217   StringList imageNames;
00218 
00219  <font class="keyword">public</font>:
00220   MatchedDetectionList(<font class="keyword">const</font> <a class="code" href="class_starlist.html">DetectionList</a> &amp;L);
00221   <font class="keywordtype">void</font> ApplyCuts();
00222 
00223   <font class="keywordtype">bool</font> OneToOneAssoc(<font class="keyword">const</font> string &amp;ImageName, <a class="code" href="class_starlist.html">DetectionList</a> &amp;L);
00224 };
00225 
00226 
00227 <font class="keyword">typedef</font> MatchedDetectionList::iterator MatchedDetectionIterator;
00228 <font class="keyword">typedef</font> MatchedDetectionList::const_iterator MatchedDetectionCIterator;
00229 
00230 
00231 
00232 <font class="preprocessor">#endif </font><font class="comment">/*DETECTION__H */</font>
</pre></div><hr><address><small>Generated at Sun Feb 8 18:22:49 2004 for toads by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.6 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
