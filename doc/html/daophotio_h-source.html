<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>daophotio.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.6 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; <a class="qindexRef" doxygen="_cgi:http://ici.la.bas/toto/tata/search.cgi" href="http://ici.la.bas/toto/tata/search.cgi">Search</a> &nbsp; </center>
<hr><h1>daophotio.h</h1><div class="fragment"><pre>00001 <font class="comment">// This may look like C code, but it is really -*- C++ -*-</font>
00002 
00003 <font class="preprocessor">#ifndef DAOPHOTIO__H</font>
00004 <font class="preprocessor"></font><font class="preprocessor">#define DAOPHOTIO__H</font>
00005 <font class="preprocessor"></font>
00006 <font class="preprocessor">#include &lt;iomanip&gt;</font>
00007 <font class="preprocessor">#include &lt;fstream&gt;</font>
00008 <font class="preprocessor">#include "daophotpsf.h"</font>
00009 <font class="preprocessor">#include "<a class="code" href="sestar_h.html">sestar.h</a>"</font>
00010 <font class="preprocessor">#include "reducedimage.h"</font>
00011 
00013 <font class="keyword">const</font> <font class="keywordtype">double</font> DAOPHOT_APER_ZP = 25.;
00014 
00016 <font class="keyword">const</font> <font class="keywordtype">double</font> DAOPHOT_TOADS_SHIFT = -1.;
00017 
00019 <font class="keywordtype">int</font> DaoFileNumber(<font class="keyword">const</font> DbImageCatalogKind FileType);
00020 
00022 template&lt;DbImageCatalogKind filetype&gt; 
00023 <font class="keywordtype">void</font> read_dao_star(istream &amp;daostream, <a class="code" href="class_sestar.html">SEStar</a> &amp;star);
00024 
00026 template&lt;DbImageCatalogKind filetype&gt; 
00027 <font class="keywordtype">void</font> read_dao_starlist(istream &amp;daostream, <a class="code" href="class_starlist.html">SEStarList</a> &amp;Stars, <font class="keyword">const</font> <font class="keywordtype">double</font> zp=DAOPHOT_APER_ZP)<font class="keyword"></font>
00028 <font class="keyword"></font>{
00029   <font class="keywordtype">char</font> c;
00030   <font class="keywordflow">while</font> (daostream &gt;&gt; c) <font class="comment">// end-of-file test</font>
00031     {
00032       daostream.unget();
00033       <a class="code" href="class_sestar.html">SEStar</a> *star = <font class="keyword">new</font> <a class="code" href="class_sestar.html">SEStar</a>;
00034       <font class="keywordtype">double</font> x,y, mag;
00035       daostream &gt;&gt; star-&gt;N() &gt;&gt; x &gt;&gt; y &gt;&gt; mag;
00036       <font class="comment">// DAOPHOT to TOADS conversion x,y and flux</font>
00037       star-&gt;x = x + DAOPHOT_TOADS_SHIFT; 
00038       star-&gt;y = y + DAOPHOT_TOADS_SHIFT;
00039       star-&gt;flux = pow(10.,(0.4*(zp - mag)));
00040       read_dao_star&lt;filetype&gt;(daostream, *star); 
00041       Stars.push_back(star);
00042     }
00043 }
00044 
00046 template&lt;DbImageCatalogKind filetype&gt; 
00047 <font class="keywordtype">void</font> read_dao(<font class="keyword">const</font> string &amp;FileName, <a class="code" href="class_starlist.html">SEStarList</a> &amp;Stars, <font class="keyword">const</font> <font class="keywordtype">double</font> zp=DAOPHOT_APER_ZP)<font class="keyword"></font>
00048 <font class="keyword"></font>{
00049   ifstream daostream(FileName.c_str());
00050   <font class="keywordflow">if</font> (!daostream) 
00051     {
00052       cerr &lt;&lt; <font class="stringliteral">" read_dao : unable to open file '"</font> 
00053            &lt;&lt; FileName &lt;&lt; <font class="stringliteral">"'"</font> &lt;&lt; endl;
00054       <font class="keywordflow">return</font>;
00055     }
00056   string dummy;
00057   getline(daostream, dummy);
00058   getline(daostream, dummy);
00059   read_dao_starlist&lt;filetype&gt;(daostream, Stars, zp); 
00060 }
00061 
00063 template&lt;DbImageCatalogKind filetype&gt; 
00064 <font class="keywordtype">void</font> read_dao(<font class="keyword">const</font> <a class="code" href="class_dbimage.html">DbImage</a>&amp; Dbim, <a class="code" href="class_starlist.html">SEStarList</a> &amp;Stars)<font class="keyword"></font>
00065 <font class="keyword"></font>{
00066   <font class="keywordtype">double</font> zp = DAOPHOT_APER_ZP;
00067   <font class="keywordflow">if</font> (((filetype == DaophotAls)||
00068        (filetype == DaophotPk) ||
00069        (filetype == DaophotNst))
00070       &amp;&amp; FileExists(Dbim.<a class="code" href="class_dbimage.html#a25">ImagePsfName</a>()))
00071     {
00072       DaoPsf psf(Dbim);
00073       zp = psf.PsfMag();
00074     }
00075   read_dao&lt;filetype&gt;(Dbim.<a class="code" href="class_dbimage.html#a24">ImageCatalogName</a>(filetype), Stars, zp);
00076 }
00077 
00079 template&lt;DbImageCatalogKind filetype&gt; 
00080 <font class="keywordtype">void</font> write_dao_star(ostream &amp;daostream, <font class="keyword">const</font> <a class="code" href="class_sestar.html">SEStar</a> &amp;star);
00081 
00083 template&lt;DbImageCatalogKind filetype&gt; 
00084 <font class="keywordtype">void</font> write_dao_header(ostream &amp;daostream, <font class="keyword">const</font> <font class="keywordtype">int</font> Nx, <font class="keyword">const</font> <font class="keywordtype">int</font> Ny, 
00085                       <font class="keyword">const</font> <font class="keywordtype">double</font> LowBad, <font class="keyword">const</font> <font class="keywordtype">double</font> HighBad, 
00086                       <font class="keyword">const</font> <font class="keywordtype">double</font> Threshold, <font class="keyword">const</font> <font class="keywordtype">double</font> Aperture, 
00087                       <font class="keyword">const</font> <font class="keywordtype">double</font> Gain, <font class="keyword">const</font> <font class="keywordtype">double</font> ReadNoise, <font class="keyword">const</font> <font class="keywordtype">double</font> FitRad)<font class="keyword"></font>
00088 <font class="keyword"></font>{
00089   <font class="keywordtype">int</font> nl = DaoFileNumber(filetype);
00090   daostream &lt;&lt; <font class="stringliteral">" NL   NX   NY  LOWBAD HIGHBAD  THRESH     AP1  PH/ADU  RNOISE    FRAD\n"</font>; 
00091   <font class="keywordtype">int</font> ndigits=0;
00092   <font class="keywordflow">if</font> (HighBad &gt; 99999.9) ndigits=0;
00093   daostream &lt;&lt; setiosflags(ios::fixed);
00094   daostream &lt;&lt; <font class="stringliteral">" "</font> 
00095             &lt;&lt; setw(2) &lt;&lt; nl 
00096             &lt;&lt; setw(5) &lt;&lt; Nx 
00097             &lt;&lt; setw(5) &lt;&lt; Ny 
00098             &lt;&lt; setw(8) &lt;&lt; setprecision(1) &lt;&lt; LowBad 
00099             &lt;&lt; setw(8) &lt;&lt; setprecision(ndigits) &lt;&lt; HighBad 
00100             &lt;&lt; setw(8) &lt;&lt; setprecision(2) &lt;&lt; Threshold 
00101             &lt;&lt; setw(8) &lt;&lt; Aperture &lt;&lt; setw(8) &lt;&lt; Gain &lt;&lt; setw(8) &lt;&lt; ReadNoise &lt;&lt; setw(8) &lt;&lt; FitRad;
00102   daostream &lt;&lt; endl &lt;&lt; endl;
00103   daostream &lt;&lt; resetiosflags(ios::fixed);
00104 }
00105 
00107 template&lt;DbImageCatalogKind filetype&gt; 
00108 <font class="keywordtype">void</font> write_dao_header(ostream &amp;daostream, <font class="keyword">const</font> <font class="keywordtype">int</font> ncol, <font class="keyword">const</font> <font class="keywordtype">int</font> nrow, 
00109                       <font class="keyword">const</font> <font class="keywordtype">float</font> sky, <font class="keyword">const</font> <font class="keywordtype">float</font> sigma, <font class="keyword">const</font> <font class="keywordtype">float</font> *opt)<font class="keyword"></font>
00110 <font class="keyword"></font>{
00111   write_dao_header&lt;filetype&gt;(daostream, ncol, nrow, sky-opt[2]*sigma, 
00112                              opt[3], opt[5]*sigma, opt[4], opt[1], opt[0], opt[11]);
00113 }
00114 
00116 template&lt;DbImageCatalogKind filetype&gt; 
00117 <font class="keywordtype">void</font> write_dao_header(ostream &amp;daostream, <font class="keyword">const</font> <a class="code" href="class_reducedimage.html">ReducedImage</a> &amp;Rim)<font class="keyword"></font>
00118 <font class="keyword"></font>{
00119   write_dao_header&lt;filetype&gt;(daostream, Rim.<a class="code" href="class_reducedimage.html#a37">XSize</a>(), Rim.<a class="code" href="class_reducedimage.html#a38">YSize</a>(),
00120                              Rim.BackLevel() - 7* Rim.<a class="code" href="class_reducedimage.html#a54">SigmaBack</a>(),
00121                              Rim.<a class="code" href="class_reducedimage.html#a62">Saturation</a>(), 4*Rim.<a class="code" href="class_reducedimage.html#a54">SigmaBack</a>(), 
00122                              Rim.<a class="code" href="class_reducedimage.html#a39">Seeing</a>()*2.3548, Rim.<a class="code" href="class_reducedimage.html#a107">Gain</a>(), Rim.<a class="code" href="class_reducedimage.html#a105">ReadoutNoise</a>(), 
00123                              Rim.<a class="code" href="class_reducedimage.html#a39">Seeing</a>()*2.3548);
00124 }
00125 
00126 
00128 template&lt;DbImageCatalogKind filetype&gt; 
00129 <font class="keywordtype">void</font> write_dao_starlist(ostream &amp;daostream, <font class="keyword">const</font> <a class="code" href="class_starlist.html">SEStarList</a> &amp;Stars, <font class="keyword">const</font> <font class="keywordtype">double</font> zp =DAOPHOT_APER_ZP)<font class="keyword"></font>
00130 <font class="keyword"></font>{
00131   daostream &lt;&lt; setiosflags(ios::fixed);
00132   <font class="keywordflow">for</font> (<a class="code" href="class_starlist.html">SEStarCIterator</a> it=Stars.begin(); it!=Stars.end(); ++it)
00133     {
00134       <font class="keyword">const</font> <a class="code" href="class_sestar.html">SEStar</a> *star = *it ;
00135       <font class="keywordtype">double</font> mag = (star-&gt;flux &gt; 0)? -2.5*log10(star-&gt;flux) + zp : zp;
00136       daostream &lt;&lt; setw(6) &lt;&lt; star-&gt;N()
00137                 &lt;&lt; setprecision(3) 
00138         <font class="comment">// DAOPHOT-TOADS conventions</font>
00139                 &lt;&lt; setw(9) &lt;&lt; star-&gt;x - DAOPHOT_TOADS_SHIFT 
00140                 &lt;&lt; setw(9) &lt;&lt; star-&gt;y - DAOPHOT_TOADS_SHIFT
00141                 &lt;&lt; setw(9) &lt;&lt; mag;
00142       write_dao_star&lt;filetype&gt;(daostream, *star);
00143       daostream &lt;&lt; endl;
00144     }
00145   daostream &lt;&lt; resetiosflags(ios::fixed);
00146 }
00147 
00149 template&lt;DbImageCatalogKind filetype&gt; 
00150 <font class="keywordtype">void</font> write_dao(<font class="keyword">const</font> <a class="code" href="class_reducedimage.html">ReducedImage</a> &amp;Rim, <font class="keyword">const</font> <a class="code" href="class_starlist.html">SEStarList</a> &amp;Stars)<font class="keyword"></font>
00151 <font class="keyword"></font>{
00152   ofstream daostream((Rim.<a class="code" href="class_dbimage.html#a24">ImageCatalogName</a>(filetype)).c_str());
00153   write_dao_header&lt;filetype&gt;(daostream, Rim);
00154   write_dao_starlist&lt;filetype&gt;(daostream, Stars); 
00155 }
00156 
00158 template&lt;DbImageCatalogKind filetype&gt; 
00159 <font class="keywordtype">void</font> write_dao(<font class="keyword">const</font> string FileName, <font class="keyword">const</font> <font class="keywordtype">int</font> ncol, <font class="keyword">const</font> <font class="keywordtype">int</font> nrow, 
00160                <font class="keyword">const</font> <font class="keywordtype">float</font> sky, <font class="keyword">const</font> <font class="keywordtype">float</font> sigma, 
00161                <font class="keyword">const</font> <font class="keywordtype">float</font> *opt, <font class="keyword">const</font> <a class="code" href="class_starlist.html">SEStarList</a> &amp;Stars)<font class="keyword"></font>
00162 <font class="keyword"></font>{
00163   ofstream daostream(FileName.c_str());
00164   write_dao_header&lt;filetype&gt;(daostream, ncol, nrow, sky, sigma, opt);
00165   write_dao_starlist&lt;filetype&gt;(daostream, Stars); 
00166 }
00167 
00168 
00170 template&lt;DbImageCatalogKind filetype&gt; 
00171 <font class="keywordtype">void</font> CombineSextractorDaophot(<font class="keyword">const</font> <a class="code" href="class_dbimage.html">DbImage</a> &amp;DbIm, 
00172                               <font class="keyword">const</font> <font class="keywordtype">bool</font> ReplacePos=<font class="keyword">true</font>, 
00173                               <font class="keyword">const</font> <font class="keywordtype">bool</font> ReplaceFlux=<font class="keyword">false</font>,
00174                               <font class="keyword">const</font> <font class="keywordtype">bool</font> ReplaceSky=<font class="keyword">false</font>)<font class="keyword"></font>
00175 <font class="keyword"></font>{
00176   <font class="keywordflow">if</font> (filetype == SExtractor) 
00177     {
00178       cout &lt;&lt; <font class="stringliteral">" CombineSextractorDaophot: WARNING : combining the same sextractor catalogs !!!"</font> &lt;&lt; endl;
00179       <font class="keywordflow">return</font>;
00180     }
00181 
00182   <a class="code" href="class_starlist.html">SEStarList</a> sexstars(DbIm.<a class="code" href="class_dbimage.html#a24">ImageCatalogName</a>(SExtractor));  
00183   <a class="code" href="class_starlist.html">SEStarList</a> daostars;
00184   read_dao&lt;filetype&gt;(DbIm, daostars);
00185 
00186   <a class="code" href="class_starlist.html">SEStarIterator</a> enddao = daostars.end();
00187   size_t ndeleted = 0;
00188 
00189   <font class="keywordflow">for</font> (<a class="code" href="class_starlist.html">SEStarIterator</a> itsex = sexstars.begin(); itsex != sexstars.end(); ++itsex)
00190     {
00191       <a class="code" href="class_starlist.html">SEStarCIterator</a> itdao = daostars.begin();
00192       <font class="keywordflow">while</font> (itdao != enddao &amp;&amp; (*itdao)-&gt;N() != (*itsex)-&gt;N()) ++itdao;
00193       <font class="keywordflow">if</font> (itdao == enddao) 
00194         { 
00195           ndeleted++;
00196           <font class="keywordflow">continue</font>;
00197         }
00198 
00199       (*itsex)-&gt;Iter()  = (*itdao)-&gt;Iter();
00200       (*itsex)-&gt;Chi()   = (*itdao)-&gt;Chi();
00201       (*itsex)-&gt;Sharp() = (*itdao)-&gt;Sharp();
00202 
00203       <font class="keywordflow">if</font> (ReplacePos)
00204         {
00205           (*itsex)-&gt;x = (*itdao)-&gt;x;
00206           (*itsex)-&gt;y = (*itdao)-&gt;y;
00207         }
00208 
00209       <font class="keywordflow">if</font> (ReplaceFlux)
00210         {
00211           (*itsex)-&gt;flux = (*itdao)-&gt;flux;
00212           (*itsex)-&gt;EFlux() = (*itdao)-&gt;EFlux();
00213         }
00214 
00215       <font class="keywordflow">if</font> (ReplaceSky)(*itsex)-&gt;Fond() = (*itdao)-&gt;Fond();
00216     }   
00217 
00218   <font class="keywordflow">if</font> (ndeleted&gt;0) cout &lt;&lt; <font class="stringliteral">" CombineSextractorDaophot : did not find "</font>
00219                        &lt;&lt; ndeleted &lt;&lt; <font class="stringliteral">" in daophot catalog "</font> &lt;&lt; endl; 
00220 
00221   sexstars.write(DbIm.<a class="code" href="class_dbimage.html#a24">ImageCatalogName</a>(SExtractor));
00222 }
00223 
00224 
00225 <font class="preprocessor">#endif // DAOPHOTIO__H</font>
</font></pre></div><hr><address><small>Generated at Sun Feb 8 18:22:49 2004 for toads by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.6 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
